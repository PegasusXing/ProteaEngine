cmake_minimum_required(VERSION 3.31)
project(ProteaEngine)

# Default fallback
set(DEFAULT_CXX_STANDARD 23)

if (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
    # Limit GCC to C++17 to avoid known issues with DLLs
    set(DEFAULT_CXX_STANDARD 17)
elseif (CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
    set(DEFAULT_CXX_STANDARD 23)
elseif (CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
    set(DEFAULT_CXX_STANDARD 20)
endif()

# Apply it globally or per target
set(CMAKE_CXX_STANDARD ${DEFAULT_CXX_STANDARD})
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Set target platform architecture fallback
if (NOT CMAKE_GENERATOR_PLATFORM)
    if(CMAKE_SIZEOF_VOID_P EQUAL 8)
        set(PROTEA_ARCH "x64")
    else()
        set(PROTEA_ARCH "Win32")
    endif()
else()
    set(PROTEA_ARCH ${CMAKE_GENERATOR_PLATFORM})
endif()

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/${CMAKE_BUILD_TYPE}_${PROTEA_ARCH}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/${CMAKE_BUILD_TYPE}_${PROTEA_ARCH}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/${CMAKE_BUILD_TYPE}_${PROTEA_ARCH}/lib)

# Add subdirectories
add_subdirectory(ProteaCore)
add_subdirectory(ProteaSandbox)